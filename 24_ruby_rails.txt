# Set up my Rail app
#
# Install sqlite dev tools.
# (needed only the first time)
sudo apt-get install libsqlite3-dev


# get the source code
cd ~/src
git clone https://github.com/hectorcorrea/hkrails.git


# Deploy it
# TODO: backup production DB first
cd 
rm -rf ~/hkrails/
cp -r ~/src/hkrails/ .


# Install gems locally.
cd ~/hkrails/
bundle install --deployment


# Compile assets
bundle exec rake assets:precompile


# Migrate the DB
RAILS_ENV=production bundle exec rake db:migrate


# Setup environment variable SECRET_KEY_BASE_HKRAILS
export SECRET_KEY_BASE_HKRAILS=<secret value goes here>


# Run it (standalone)
RAILS_ENV=production bundle exec rails server


# Run it (via thin)
RAILS_ENV=production bundle exec thin start -C myapp.yml
RAILS_ENV=production bundle exec thin stop -C myapp.yml
