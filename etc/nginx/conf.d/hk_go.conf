#######################################################
# h&k
#######################################################
server {

  listen          80;
  server_name     insert-name-here.com; www.insert-name-here.com

  proxy_next_upstream http_502 http_504 error timeout invalid_header;
  proxy_set_header Host $host;
  proxy_set_header X-Forwarded-For  $remote_addr;

  # Cache our static files
  # for everybody (authenticated or not)
  location ~/public/ {
    proxy_pass http://localhost:3003;
    proxy_cache cache_one;
    add_header X-Proxy-Cache $upstream_cache_status;
    add_header hk asset2;
    break;
  }

  # Cache the root page for non-authenticated users
  location = / {
    proxy_pass http://localhost:3003;
    proxy_cache cache_one;
    proxy_cache_bypass $cookie_sessionId;
    proxy_no_cache $cookie_sessionId;
    add_header X-Proxy-Cache $upstream_cache_status;
    add_header hk root2;
    break;
  }

  # Cache all other for non-authenticated users.
  location / {
    proxy_pass http://localhost:3003;
    proxy_cache cache_one;
    proxy_cache_bypass $cookie_sessionId;
    proxy_no_cache $cookie_sessionId;
    add_header hk page2;
    break;
  }

}
